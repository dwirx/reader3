<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ book.metadata.title }}</title>
    <link rel="stylesheet" href="/static/reader.css">
</head>
<body>

    <!-- SIDEBAR -->
    <div id="sidebar">
        <a href="/" class="nav-home">â† Back to Library</a>
        <div class="nav-header">{{ book.metadata.title }}</div>

        <!-- Recursive Macro for TOC -->
        {% macro render_toc(items) %}
            <ul class="toc-list">
            {% for item in items %}
                <li class="toc-item">
                    {% set is_active = current_chapter.href == item.file_href %}
                    <a href="#" onclick="findAndGo('{{ item.file_href }}')"
                       class="toc-link {% if is_active %}active{% endif %}">
                        {{ item.title }}
                    </a>
                    {% if item.children %}
                        {{ render_toc(item.children) }}
                    {% endif %}
                </li>
            {% endfor %}
            </ul>
        {% endmacro %}

        {{ render_toc(book.toc) }}
    </div>

    <!-- MAIN CONTENT -->
    <div id="main">
        <div class="content-container">
            <div class="book-content">
                {{ current_chapter.content | safe }}
            </div>

            <div class="chapter-nav">
                {% if prev_idx is not none %}
                    <a href="/read/{{ book_id }}/{{ prev_idx }}" class="nav-btn">â† Previous</a>
                {% else %}
                    <span class="nav-btn disabled">â† Previous</span>
                {% endif %}

                <span style="color: #999; padding: 10px;">
                    Section {{ chapter_index + 1 }} of {{ book.spine|length }}
                </span>

                {% if next_idx is not none %}
                    <a href="/read/{{ book_id }}/{{ next_idx }}" class="nav-btn">Next â†’</a>
                {% else %}
                    <span class="nav-btn disabled">Next â†’</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Translation Toolbar -->
    <div class="translate-toolbar">
        <span style="color: #6b7280; font-weight: 500;">ğŸŒ Translate:</span>
        <select class="lang-select" id="targetLang" title="Target Language">
            <option value="id">ğŸ‡®ğŸ‡© Indonesia</option>
            <option value="en">ğŸ‡¬ğŸ‡§ English</option>
            <option value="zh-CN">ğŸ‡¨ğŸ‡³ Chinese</option>
            <option value="ja">ğŸ‡¯ğŸ‡µ Japanese</option>
            <option value="ko">ğŸ‡°ğŸ‡· Korean</option>
            <option value="ar">ğŸ‡¸ğŸ‡¦ Arabic</option>
            <option value="es">ğŸ‡ªğŸ‡¸ Spanish</option>
            <option value="fr">ğŸ‡«ğŸ‡· French</option>
            <option value="de">ğŸ‡©ğŸ‡ª German</option>
            <option value="ru">ğŸ‡·ğŸ‡º Russian</option>
            <option value="pt">ğŸ‡µğŸ‡¹ Portuguese</option>
            <option value="it">ğŸ‡®ğŸ‡¹ Italian</option>
            <option value="th">ğŸ‡¹ğŸ‡­ Thai</option>
            <option value="vi">ğŸ‡»ğŸ‡³ Vietnamese</option>
        </select>
        <button class="translate-btn" id="translateBtn" onclick="translateSelection()" disabled title="Select text first, then click to translate">
            Select Text First
        </button>
        <button class="translate-page-btn" id="translatePageBtn" onclick="translateFullPage()" title="Translate all text on this page">
            ğŸ“„ Translate Page
        </button>
    </div>

    <script>
        // Pass data from backend to JavaScript
        const spineMap = {
            {% for ch in book.spine %}
            "{{ ch.href }}": {{ ch.order }},
            {% endfor %}
        };
        const bookId = "{{ book_id }}";
        
        // Make them globally available
        window.spineMap = spineMap;
        window.bookId = bookId;
    </script>
    
    <!-- Load external JavaScript module -->
    <script src="/static/reader.js"></script>
</body>
</html>
